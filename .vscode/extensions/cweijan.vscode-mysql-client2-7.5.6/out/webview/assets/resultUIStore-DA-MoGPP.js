import{y as m,au as n,j as s}from"./app-FmU7_e9B.js";import{D as r}from"./constants-DOH9Mr1f.js";import{w as u}from"./wrapper-DzkwKkkl.js";function f(t){return console.log("type:",t),t?t.match(/(LOB|BINARY|geomcollection|POINT|GEOMETRY|LINESTRING|POLYGON)/i)==null:!1}function N(t){return t.filter(i=>f(i.type)||i.type.match(/(JSON)/i)==null)}function v(t,i){if(!i)return null;switch(t){case r.MYSQL:case r.MARIA_DB:const{columnType:e,columnLength:l,flags:b}=i;return o[e]=="blob"&&b==16?l==1020?"TINYTEXT":"text":o[e];case r.PG:case r.REDSHIFT:return c[i.dataTypeID];default:return i.type}}var c=(t=>(t[t.bool=16]="bool",t[t.bytea=17]="bytea",t[t.char=18]="char",t[t.bigint=20]="bigint",t[t.smallint=21]="smallint",t[t.integer=23]="integer",t[t.regproc=24]="regproc",t[t.text=25]="text",t[t.oid=26]="oid",t[t.tid=27]="tid",t[t.xid=28]="xid",t[t.cid=29]="cid",t[t.json=114]="json",t[t.xml=142]="xml",t[t.pg_node_tree=194]="pg_node_tree",t[t.smgr=210]="smgr",t[t.path=602]="path",t[t.polygon=604]="polygon",t[t.cidr=650]="cidr",t[t.real=700]="real",t[t["double precision"]=701]="double precision",t[t.abstime=702]="abstime",t[t.reltime=703]="reltime",t[t.tinterval=704]="tinterval",t[t.circle=718]="circle",t[t.macaddr8=774]="macaddr8",t[t.money=790]="money",t[t.macaddr=829]="macaddr",t[t.inet=869]="inet",t[t.aclitem=1033]="aclitem",t[t.character=1042]="character",t[t.varchar=1043]="varchar",t[t.date=1082]="date",t[t.time=1083]="time",t[t.timestamp=1114]="timestamp",t[t.timestamptz=1184]="timestamptz",t[t.interval=1186]="interval",t[t.timetz=1266]="timetz",t[t.bit=1560]="bit",t[t.varbit=1562]="varbit",t[t.numeric=1700]="numeric",t[t.refcursor=1790]="refcursor",t[t.regprocedure=2202]="regprocedure",t[t.regoper=2203]="regoper",t[t.regoperator=2204]="regoperator",t[t.regclass=2205]="regclass",t[t.regtype=2206]="regtype",t[t.uuid=2950]="uuid",t[t.txid_snapshot=2970]="txid_snapshot",t[t.pg_lsn=3220]="pg_lsn",t[t.pg_ndistinct=3361]="pg_ndistinct",t[t.pg_dependencies=3402]="pg_dependencies",t[t.tsvector=3614]="tsvector",t[t.tsquery=3615]="tsquery",t[t.gtsvector=3642]="gtsvector",t[t.regconfig=3734]="regconfig",t[t.regdictionary=3769]="regdictionary",t[t.jsonb=3802]="jsonb",t[t.regnamespace=4089]="regnamespace",t[t.regrole=4096]="regrole",t))(c||{}),o=(t=>(t[t.decimal=0]="decimal",t[t.tinyint=1]="tinyint",t[t.smallint=2]="smallint",t[t.int=3]="int",t[t.float=4]="float",t[t.double=5]="double",t[t.null=6]="null",t[t.timestamp=7]="timestamp",t[t.bigint=8]="bigint",t[t.int24=9]="int24",t[t.date=10]="date",t[t.time=11]="time",t[t.datetime=12]="datetime",t[t.year=13]="year",t[t.newdate=14]="newdate",t[t.bit=16]="bit",t[t.timestamp2=17]="timestamp2",t[t.datetime2=18]="datetime2",t[t.time2=19]="time2",t[t.json=245]="json",t[t.newdecimal=246]="newdecimal",t[t.enum=247]="enum",t[t.set=248]="set",t[t.tiny_blob=249]="tiny_blob",t[t.medium_blob=250]="medium_blob",t[t.long_blob=251]="long_blob",t[t.blob=252]="blob",t[t.varchar=253]="varchar",t[t.string=254]="string",t[t.geometry=255]="geometry",t))(o||{});const h=m("result",{state:()=>({data:[],backupData:[],fields:[],dbType:null,costTime:0,sql:"",transId:null,hasTruncate:!1,readonly:!1,reverseData:!1,columnList:null,columnTypeMap:null,database:null,table:null,withDot:null,tableCount:null,pageNum:null,pageSize:null}),getters:{noTable(t){return t.tableCount!=1},primaryKeyList(t){var i;return[r.ES,r.MONGO_DB].includes(t.dbType)?[{name:"_id"}]:(i=t.columnList)==null?void 0:i.filter(e=>e.isPrimary)},hasPK(){var t;return(t=this.primaryKeyList)==null?void 0:t.length}},actions:{getTypeByField(t){var i,e;return this.dbType==r.ES&&t.name=="_id"?"text":((e=(i=this.columnTypeMap)==null?void 0:i[t.name])==null?void 0:e.type)??v(this.dbType,t)}}});function R(t,i){return t?h().withDot?u(t,i):t.split(".").map(l=>u(l,i)).join("."):null}class w{constructor(){this.commands=[],this.index=0}push(i){this.commands.push(i),this.index=this.commands.length-1}previous(){if(this.commands.length!=0){if(this.index--<0){this.index=0;return}return this.commands[this.index]}}next(){if(this.commands.length!=0){if(this.index++>=this.commands.length){this.index=this.commands.length-1;return}return this.commands[this.index]}}}const a=h(),j=m("UI",{state:()=>({showSQLPanel:!1,history:new w,state:{...n},user:null,viewColumn:2,viewType:"Default",info:{sql:null,message:null,error:!1},tableStatus:{remainHeight:0,doNotClear:!1,loadingTimeout:null,rawColumnWidth:500},table:{search:"",loading:!1,start:new Date().getTime(),loadingTimer:null,widthItem:{},sort:{ascIndex:null,descIndex:null},sortKeys:[],expandKeys:[],selectedRows:[],selectedRowKeys:[]},page:{pageNum:1,pageSize:-1,total:0},dialog:{importVisible:!1,exportVisible:!1,detailScope:null,detailVisible:!1},toolbar:{sql:null,showSaveBtn:!1,saveLoading:!1,filter:{},showColumns:[]},deleteConfirm:{sql:"",visible:!1,skipForeignCheck:!1}}),getters:{hasResult(){var t;return((t=a.fields)==null?void 0:t.length)>0},notAllowUpdate(){return a.tableCount!=1||a.readonly||!this.hasResult},notAllowUpdateLevel2(){return this.notAllowUpdate||this.reverseData},isSplitView(){return this.viewColumn>=2},reverseData(){return this.viewType=="Reverse"}},actions:{checkShowSQLPanel(){var t,i,e;if(this.isSplitView&&([r.ES].includes(a.dbType)||window.innerHeight<500||((e=(i=(t=this.toolbar)==null?void 0:t.sql)==null?void 0:i.match(/\n/g))==null?void 0:e.length)>1))return this.showSQLPanel=!1;this.showSQLPanel=!0},resetConfig(){this.viewType="Default";for(const t of Object.keys(n))t!="resetFilter"&&(this.state[t]=n[t],s.emit("upState",{key:t,value:n[t],ignore:!0}))},refresh(){this.execute(a.sql)},execute(t,i={}){t&&(s.emit("executeSQL",{sql:t,...i}),this.table.start=new Date().getTime(),this.queueLoading())},queueLoading(){this.tableStatus.doNotClear||(this.info.message=null),clearTimeout(this.tableStatus.loadingTimeout),this.tableStatus.loadingTimeout=setTimeout(()=>{this.table.loading=!0,a.costTime=0,clearInterval(this.table.loadingTimer),this.table.loadingTimer=setInterval(()=>{a.costTime=new Date().getTime()-this.table.start},79)},100)}}});export{h as a,N as g,j as u,R as w};
