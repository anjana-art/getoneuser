import{s as j,e as E}from"./notify-B6nz1WA5.js";import{d as A,r as x,h as f,c as O,C as P,j as p,a as b,e as u,f as a,q as n,b as z,k as G,o as s,F as _,v,l as y,s as h,t as T}from"./app-FmU7_e9B.js";import{a as J,E as K}from"./index-DHYa3W9-.js";import{a as W,E as X}from"./index-DKFN2YvA.js";import{E as Y,a as Z}from"./index-ZkvlXBU0.js";import"./focus-trap-BpsD0gin.js";import"./validator-IqtOGJg6.js";import"./index-BVSJCwKb.js";import"./castArray-DZ-7eylf.js";import"./clone-FvXKwRYn.js";import"./_baseClone-BmLEUuwE.js";import"./isEqual-BzW8q1RT.js";import"./_initCloneObject-brd83mMv.js";import"./index-CGvgoY8n.js";import"./index-DnsqOKfX.js";import"./isUndefined-DCTLXrZ8.js";import"./_baseIteratee-DKJhV95b.js";import"./merge-DpnD1hi4.js";import"./isArrayLikeObject-BJavgoKj.js";import"./index-D0Za3L6V.js";import"./index-VUXoUYxw.js";import"./index-B-IAPgrp.js";import"./_baseFindIndex-D7XfJLKM.js";const $=u("div",{style:{margin:"30px 20px"}}," Structure sync is being refactored and is currently unavailable ",-1),ee={class:"opt-panel"},te=["src"],le={class:"opt-panel"},oe=["src"],ae={key:0,class:"bg-secondBg pl-5 pt-3"},ne={class:"mb-3"},Ee=A({__name:"structDiff",setup(se){const D=x([{value:"MySQL",icon:"resources/icon/server/mysql_dark.svg"},{value:"MariaDB",icon:"resources/icon/server/mariadb.svg"},{value:"PostgreSQL",icon:"resources/icon/server/pgsql.svg"}]),C=x(null),L=x([]),r=f({dbLoading:!1,dbList:[]}),c=f({dbLoading:!1,dbList:[]}),o=f({from:{connection:null,database:null,db:null},to:{connection:null,database:null,db:null}}),d=f({compare:!1,sync:!1}),V=f({sqlList:null}),N=O(()=>window.outerHeight-340);P(()=>{p.on("nodes",t=>{L.value=t}).on("sourceDB",t=>{r.dbList=t,r.dbLoading=!1}).on("targetDB",t=>{c.dbList=t,c.dbLoading=!1}).on("compareResult",t=>{t.sqlList=t,d.compare=!1}).on("syncSuccess",()=>{j("syncSuccess"),d.sync=!1}).on("success",()=>{Q()}).on("error",t=>{E(t),d.sync=!1}).init()});const S=t=>{for(const l of D.value)if(l.value==t)return l.icon;return"icon/server/mysql_dark.svg"},F=t=>{p.emit("loadDB",{key:t}),r.dbLoading=!0,r.dbList=[],o.from.db=null,o.from.database=null},U=t=>{p.emit("loadDB",{key:t,isTarget:!0}),c.dbLoading=!0,c.dbList=[],o.to.db=null,o.to.database=null},q=(t,l)=>{const m=l?r.dbList:c.dbList;for(const i of m)i.label==t&&(l?o.from.db=i:o.to.db=i)},M=()=>{d.compare=!0,p.emit("start",o)},H=()=>{const t=C.value.getCheckboxRecords();if(!t||t.length==0){E("Need to select at least one sql!");return}d.sync=!0,p.emit("sync",{sqlList:t,option:o})},I=t=>{console.log("selectionChange",t)},Q=()=>{p.emit("init")};return(t,l)=>{const m=Y,i=Z,g=K,w=J,B=G("vsc-button"),k=X,R=W;return s(),b("div",null,[$,u("div",ee,[a(w,null,{default:n(()=>[a(g,{"label-width":"80px",label:"Target"},{default:n(()=>[a(i,{modelValue:o.from.connection,"onUpdate:modelValue":l[0]||(l[0]=e=>o.from.connection=e),filterable:"",onChange:F},{default:n(()=>[(s(!0),b(_,null,v(L.value,e=>(s(),y(m,{key:e.key,label:e.label,value:e.key},{default:n(()=>[u("img",{src:S(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,te),h(" "+T(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{"label-width":"80px",label:"database"},{default:n(()=>[a(i,{modelValue:o.from.database,"onUpdate:modelValue":l[1]||(l[1]=e=>o.from.database=e),loading:r.dbLoading,filterable:"",onChange:l[2]||(l[2]=e=>q(e,!0))},{default:n(()=>[(s(!0),b(_,null,v(r.dbList,e=>(s(),y(m,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),u("div",le,[a(w,null,{default:n(()=>[a(g,{"label-width":"90px",label:"Sync From"},{default:n(()=>[a(i,{modelValue:o.to.connection,"onUpdate:modelValue":l[3]||(l[3]=e=>o.to.connection=e),filterable:"",onChange:U},{default:n(()=>[(s(!0),b(_,null,v(L.value,e=>(s(),y(m,{key:e.key,label:e.label,value:e.key},{default:n(()=>[u("img",{src:S(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,oe),h(" "+T(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{"label-width":"90px",label:"database"},{default:n(()=>[a(i,{modelValue:o.to.database,"onUpdate:modelValue":l[4]||(l[4]=e=>o.to.database=e),loading:c.dbLoading,filterable:"",onChange:l[5]||(l[5]=e=>q(e,!1))},{default:n(()=>[(s(!0),b(_,null,v(c.dbList,e=>(s(),y(m,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),a(B,{stlye:"margin-left:250px;",class:"m-2",loading:d.compare,title:"Start Compare",onClick:M},{default:n(()=>[h(" Compare ")]),_:1},8,["loading"]),u("div",null,[V.sqlList?(s(),b("div",ae,[u("div",ne,[a(B,{loading:d.sync,title:"Confrim Sync",onClick:H},{default:n(()=>[h(" Sync ")]),_:1},8,["loading"])]),a(R,{ref_key:"dataTable",ref:C,data:V.sqlList,height:N.value,style:{width:"100%"},onSelectionChange:I},{default:n(()=>[a(k,{type:"checkbox",width:"40",fixed:"left"}),a(k,{align:"center",width:"60",field:"type",label:"type"}),a(k,{align:"center",field:"sql",label:"sql"})]),_:1},8,["data","height"])])):z("",!0)])])}}});export{Ee as default};
