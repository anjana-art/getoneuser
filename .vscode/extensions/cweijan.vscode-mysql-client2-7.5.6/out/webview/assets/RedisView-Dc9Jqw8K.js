import{y as re,j as v,d as D,r as w,G as F,k as K,o as m,a as I,e as V,f as i,q as c,l as h,u as n,t as R,J,$,D as de,E as ue,_ as Z,c as M,b as _,s as U,ac as ce,F as Y,v as me,V as j,X as q,I as pe,am as ye}from"./app-FmU7_e9B.js";import{R as ve}from"./constants-DOH9Mr1f.js";import{d as H}from"./objectUtil-Z6JRxuBJ.js";import{E as fe,u as _e}from"./dialogStore-C28DPkwe.js";import{c as ge,s as ke,p as be,l as he}from"./common_view_utils-BWbIU8MY.js";import{e as A,c as X,s as Q}from"./notify-B6nz1WA5.js";import{E as W,a as ee}from"./index-ZkvlXBU0.js";import{E as te}from"./index-BVSJCwKb.js";import{E as xe}from"./index-DnsqOKfX.js";import{E as Se,a as le}from"./index-DHYa3W9-.js";import{E as we}from"./index-CI6BNAfi.js";import{E as Ve,a as Ee}from"./index-DKFN2YvA.js";import{c as Ie}from"./codemirror-Bdvi3aoE.js";import"./focus-trap-BpsD0gin.js";import"./validator-IqtOGJg6.js";import"./isEqual-BzW8q1RT.js";import"./index-CGvgoY8n.js";import"./index-VUXoUYxw.js";import"./index-B-IAPgrp.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-DKJhV95b.js";import"./castArray-DZ-7eylf.js";import"./isUndefined-DCTLXrZ8.js";import"./clone-FvXKwRYn.js";import"./_baseClone-BmLEUuwE.js";import"./_initCloneObject-brd83mMv.js";import"./merge-DpnD1hi4.js";import"./isArrayLikeObject-BJavgoKj.js";import"./index-D0Za3L6V.js";import"./_commonjsHelpers-Cpj98o6Y.js";const L=re("redis",{state:()=>({remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(s){if(s!=null&&(this.itemModel.value=s),!this.edit.name)return A("Key name cannot be null!");v.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),Ne=s=>(de("data-v-109341ab"),s=s(),ue(),s),ze={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},Ce={key:1,class:"key-label key-detail-type"},Te=Ne(()=>V("span",{class:"key-label"},"TTL",-1)),$e=D({__name:"RedisKeyInfo",setup(s){const e=w(!1),t=L(),{key:l,edit:p}=F(t),f=()=>{X($("confirm.deleteRedisKey")).then(()=>{v.emit("del",{key:{name:t.key.name}}),t.key={},t.edit={}})},g=()=>{v.emit("rename",{key:{name:t.key.name,newName:t.edit.name}})},k=()=>{v.emit("ttl",{key:{name:t.key.name,ttl:t.edit.ttl}})};return v.on("new",()=>{e.value=!0}),v.on("detail",()=>{e.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&p.value.ttl>0&&(p.value.ttl-=1)},1e3),(N,u)=>{const x=W,d=ee,y=te,S=K("vsc-button");return m(),I("div",ze,[V("div",null,[i(y,{ref:"keyNameInput",modelValue:n(p).name,"onUpdate:modelValue":u[1]||(u[1]=b=>n(p).name=b),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:J(g,["enter"])},{prepend:c(()=>[e.value?(m(),h(d,{key:0,modelValue:n(l).type,"onUpdate:modelValue":u[0]||(u[0]=b=>n(l).type=b),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:c(()=>[i(x,{value:"string",label:"STRING"}),i(x,{value:"list",label:"LIST"}),i(x,{value:"set",label:"SET"}),i(x,{value:"zset",label:"ZSET"}),i(x,{value:"hash",label:"HASH"}),i(x,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(m(),I("span",Ce,R(n(l).type),1))]),_:1},8,["modelValue"]),i(S,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:u[2]||(u[2]=b=>n(ge)(n(p).name))}),i(S,{icon:"el-icon-refresh",size:"mini",type:"secondary",onClick:u[3]||(u[3]=b=>{n(v).emit("refresh")})})]),V("div",null,[i(y,{modelValue:n(p).ttl,"onUpdate:modelValue":u[4]||(u[4]=b=>n(p).ttl=b),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:J(k,["enter"])},{prepend:c(()=>[Te]),_:1},8,["modelValue"]),i(S,{icon:"codicon codicon-save",size:"mini",onClick:k}),i(S,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:f})])])}}}),Re=Z($e,[["__scopeId","data-v-109341ab"]]),Be={key:0},Me={id:"listPanel"},Ue={class:"ml-2 inline-block"},De=["title","textContent"],Le=D({__name:"RedisListView",setup(s){const e=L(),{key:t,itemModel:l,remainHeight:p}=F(e),f=w(""),g=w(1),k=w(100),N=w(0),u=w(!1);v.on("detail",o=>{u.value=!1,g.value=o.page.pageNum,k.value=o.page.pageSize}).on("pagination",o=>{e.key.content=o}).on("success",()=>{u.value=!1});const x=M(()=>{const o=e.itemModel.old;switch(t.value.type){case"hash":return o?"Edit Hash":"Add to hash";case"set":return o?"Edit Set":"Add to set";case"zset":return o?"Edit ZSet":"Add to zset";case"list":return o?"Edit List":"Add to list"}return""}),d=(o,a)=>{v.emit("changePage",a?o:g.value+o)},y=()=>{u.value=!0,e.itemModel={old:null,key:null,index:null,score:null,value:null}},S=M(()=>{t.value.content||(t.value.content=[]);const o=f.value,a=t.value.content.filter(E=>!o||(E.value?E.value.includes(o):E.includes(o)));return N.value=t.value.count??a.length,a}),b=o=>{X($("confirm.deleteRedisKey")).then(()=>{v.emit("deleteLine",o)})},O=o=>{navigator.clipboard.writeText(o.value??o),Q($("common.copied"))},P=o=>{e.itemModel={...o,old:{...o}},u.value=!0};return(o,a)=>{const E=te,z=K("vsc-button"),ne=xe,ie=fe,B=Se,oe=le,ae=we,C=Ve,se=Ee;return["list","hash","set","zset","stream"].includes(n(t).type)?(m(),I("div",Be,[V("div",Me,[i(E,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=r=>f.value=r),class:"filter-input mb-2",size:"small",placeholder:n($)("result.searchNotice"),style:{width:"200px"},clearable:!0},null,8,["modelValue","placeholder"]),i(ne,{class:"item",effect:"dark",content:"Add new key",placement:"bottom-start"},{default:c(()=>[V("div",Ue,[n(t).type!="stream"?(m(),h(z,{key:0,type:"icon",icon:"codicon-add text-lg",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:a[1]||(a[1]=r=>y())})):_("",!0)])]),_:1}),i(ie,{"page-size":k.value,"onUpdate:pageSize":a[2]||(a[2]=r=>k.value=r),"current-page":g.value,"onUpdate:currentPage":a[3]||(a[3]=r=>g.value=r),small:!0,total:N.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:a[4]||(a[4]=r=>d(r,!0)),onNextClick:a[5]||(a[5]=()=>d(1)),onPrevClick:a[6]||(a[6]=()=>d(-1))},null,8,["page-size","current-page","total"]),i(ae,{modelValue:u.value,"onUpdate:modelValue":a[13]||(a[13]=r=>u.value=r),title:x.value,closeOnClickModal:!1,width:"30%",class:"new-item-dialog"},{footer:c(()=>[i(z,{type:"secondary",onClick:a[11]||(a[11]=r=>u.value=!1)},{default:c(()=>[U(R(n($)("common.cancel")),1)]),_:1}),i(z,{type:"primary",onClick:a[12]||(a[12]=r=>n(e).saveListItem())},{default:c(()=>[U("Confirm")]),_:1})]),default:c(()=>[i(oe,{"label-width":"60px"},{default:c(()=>[n(t).type=="list"?(m(),h(B,{key:0,label:"index"},{default:c(()=>[i(E,{modelValue:n(l).index,"onUpdate:modelValue":a[7]||(a[7]=r=>n(l).index=r),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),n(t).type=="hash"?(m(),h(B,{key:1,label:"key"},{default:c(()=>[i(E,{modelValue:n(l).key,"onUpdate:modelValue":a[8]||(a[8]=r=>n(l).key=r),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),n(t).type=="zset"?(m(),h(B,{key:2,label:"score"},{default:c(()=>[i(E,{modelValue:n(l).score,"onUpdate:modelValue":a[9]||(a[9]=r=>n(l).score=r),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),i(B,{label:"value"},{default:c(()=>[i(E,{modelValue:n(l).value,"onUpdate:modelValue":a[10]||(a[10]=r=>n(l).value=r),size:"small"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])]),V("div",null,[i(se,{data:S.value,height:n(p),border:""},{default:c(()=>[n(t).type=="list"?(m(),h(C,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),n(t).type=="hash"?(m(),h(C,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Key",align:"center",width:"200",prop:"key"})):_("",!0),n(t).type=="zset"?(m(),h(C,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),n(t).type=="stream"?(m(),h(C,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),i(C,{"sort-by":"value",resizable:"",sortable:"",label:"Value",align:"center"},{default:c(r=>{var T;return[V("span",{class:"item-value",title:r.row.value,textContent:R(((T=r.row)==null?void 0:T.value)||r.row)},null,8,De)]}),_:1}),i(C,{label:"Operation",width:"150",align:"center"},{default:c(r=>[i(z,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:T=>{O(r.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(n(t).type)?(m(),h(z,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:T=>P(r.row)},null,8,["onClick"])):_("",!0),i(z,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:T=>b(r.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}}),Oe=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Pe=["B","k","M","G","T","P","E","Z","Y"],Fe=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ke=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],G=(s,e,t)=>{let l=s;return typeof e=="string"||Array.isArray(e)?l=s.toLocaleString(e,t):(e===!0||t!==void 0)&&(l=s.toLocaleString(void 0,t)),l};function Ae(s,e){if(s==null||!Number.isFinite(s)&&(s=parseInt(s),!Number.isFinite(s)))return"";e={bits:!1,binary:!0,...e};const t=e.bits?e.binary?Ke:Fe:e.binary?Pe:Oe;if(e.signed&&s===0)return` 0 ${t[0]}`;const l=s<0,p=l?"-":e.signed?"+":"";l&&(s=-s);let f;if(e.minimumFractionDigits!==void 0&&(f={minimumFractionDigits:e.minimumFractionDigits}),e.maximumFractionDigits!==void 0&&(f={maximumFractionDigits:e.maximumFractionDigits,...f}),s<1){const u=G(s,e.locale,f);return p+u+" "+t[0]}const g=Math.min(Math.floor(e.binary?Math.log(s)/Math.log(1024):Math.log10(s)/3),t.length-1);s/=(e.binary,1024**g),f||(s=s.toPrecision(3));const k=G(Number(s),e.locale,f),N=t[g];return`${p+k}${N}`}const Je={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3"},Ye={key:0,class:"flex"},He={class:"value-panel"},Ge=D({__name:"RedisStringView",setup(s){const e=L(),{key:t}=F(e),l=w(""),p=w("Text"),f=w(["Text","JSON","Yaml"]),g=M(()=>{var d;return Ae(((d=l.value)==null?void 0:d.length)||0)}),k=M(()=>["string","ReJSON-RL"].includes(e.key.type));window.addEventListener("keydown",d=>{k.value&&ce(d)&&d.code=="KeyS"&&N()});const N=()=>{if(!e.edit.name)return A("Key name cannot be null!");v.emit("update",{key:{name:e.key.name,newName:e.edit.name,type:e.key.type,ttl:e.edit.ttl,content:l.value}})};v.on("detailNext",()=>{u()});const u=()=>{if(!k.value)return l.value="";const d=e.edit.content,y=(d==null?void 0:d.match(/^\s*[{[]/))!=null;p.value=y?"JSON":"Text",y?x(d):l.value=d},x=d=>{var y;try{l.value=ke(be((y=d==null?void 0:d.replace)==null?void 0:y.call(d,/ /g," ")),null,2)}catch(S){console.error(S),l.value=d}};return(d,y)=>{const S=W,b=ee,O=K("vsc-button"),P=le;return m(),I(Y,null,[["string","ReJSON-RL"].includes(n(t).type)?(m(),I("div",Je,[V("div",null," Size: "+R(g.value),1),["string","ReJSON-RL"].includes(n(t).type)?(m(),I("div",Ye,[i(b,{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=o=>p.value=o),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:c(()=>[(m(!0),I(Y,null,me(f.value,o=>(m(),h(S,{key:o,value:o},{default:c(()=>[U(R(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(O,{class:"inline",icon:"codicon codicon-save",style:{height:"27px"},onClick:N},{default:c(()=>[U("Save")]),_:1})])):_("",!0)])):_("",!0),j(i(P,null,{default:c(()=>[V("div",He,[i(Ie,{ref:"cmEditor",value:l.value,"onUpdate:value":y[1]||(y[1]=o=>l.value=o),language:p.value,class:"json-panel",style:pe("height:"+n(e).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[q,["string","ReJSON-RL"].includes(n(t).type)]])],64)}}}),Ze=Z(Ge,[["__scopeId","data-v-0daab3b9"]]),je={class:"redis-view-container"},qe={key:0,style:{"text-align":"center"}},Xe={class:"mx-2"},Nt=D({__name:"RedisView",setup(s){const e=w(!0),t=L();return _e(),ye(()=>{he(100,[],l=>{t.remainHeight=l}),v.on("new",({prefix:l})=>{e.value=!1,t.key={name:l,type:ve.STRING,ttl:-1},t.edit=H(t.key)}).on("detail",l=>{e.value=!1,t.key=l.res,t.edit=H(l.res),v.emitImmediately("detailNext")}).on("error",l=>{A(l)}).on("success",l=>{Q(l)}),v.emit("init")}),(l,p)=>(m(),I("div",je,[e.value?(m(),I("div",qe," loading ")):_("",!0),j(V("div",Xe,[i(Re),i(Le),i(Ze)],512),[[q,!e.value]])]))}});export{Nt as default};
